---
- include_vars: /etc/ansible/vars/main.yml

- name: add user zabbix
  user:
    name: zabbix

- name: copy /etc/zabbix_agentd.conf
  template:
    src: zabbix_agentd.conf.j2
    dest: /etc/zabbix_agentd.conf
  notify:
    - zabbix_agentd restart

- name: copy /usr/local/sbin/zabbix_agentd
  copy:
    src: zabbix_agentd.bin
    dest: /usr/local/sbin/zabbix_agentd
    mode: 0755
  notify:
    - zabbix_agentd restart

- name: copy /etc/init.d/zabbix_agentd
  copy:
    src: zabbix_agentd.init
    dest: /etc/init.d/zabbix_agentd
    mode: 0755
  notify:
    - zabbix_agentd restart

- name: enable serveice zabbix_agentd
  service:
    name: zabbix_agentd
    enabled: yes

- name: edit /etc/sudoers
  lineinfile:
    path: /etc/sudoers
    regexp: "Defaults    requiretty"
    line: "# Defaults    requiretty"

- name: copy /etc/sudoers.d/zabbix
  copy:
    src: zabbix.sudoer
    dest: /etc/sudoers.d/zabbix
